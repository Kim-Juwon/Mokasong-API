<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mokasong.user.repository.AdminUserMapper">
    <select id="getUserForAdminPage" parameterType="long" resultMap="AdminPageUser">
        SELECT *
        FROM `mokasong`.`users`
        WHERE `user_id` = #{userId}
    </select>

    <select id="getDeliveryAddressesByUserId" parameterType="long" resultType="com.mokasong.user.dto.response.admin.UserResponse$DeliveryAddress">
        SELECT *
        FROM `mokasong`.`delivery_addresses`
        WHERE
            `user_id` = #{userId}
            AND `is_deleted` = 0
    </select>

    <select id="getUser" resultType="com.mokasong.user.entity.User">
        SELECT *
        FROM `mokasong`.`users`
        WHERE user_id = #{userId}
    </select>

    <resultMap id="AdminPageUser" type="com.mokasong.user.dto.response.admin.UserResponse$AdminPageUser">
        <id property="userId" column="user_id"/>
        <id property="email" column="email" />
        <id property="phoneNumber" column="phone_number"/>
        <id property="authority" column="authority"/>
        <id property="name" column="name"/>
        <id property="lastLoginTime" column="last_login_time"/>
        <id property="isDeleted" column="is_deleted"/>
        <id property="createdAt" column="created_at"/>
        <collection property="deliveryAddresses" column="user_id" select="getDeliveryAddressesByUserId"/>
    </resultMap>
</mapper>